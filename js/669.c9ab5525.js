"use strict";(self["webpackChunkcommity"]=self["webpackChunkcommity"]||[]).push([[669],{8669:function(e,t,i){i.r(t),i.d(t,{default:function(){return b}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"box-card"},[t("span",[e._v("角色管理")])]),t("el-row",{staticClass:"butt"},[e.$power.haveown(e.power,"添加角色")?t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("添加")]):e._e()],1),t("Table",{attrs:{loading:e.loading,tableData:e.tableData,tableCouml:e.tableCouml},scopedSlots:e._u([{key:"option",fn:function(i){return[e.$power.haveown(e.power,"修改角色")?t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.dom(i.data)}}},[e._v("修改")]):e._e(),e.$power.haveown(e.power,"删除角色")?t("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.handleDelete(i.data.id)}}},[e._v("删除")]):e._e()]}}])}),t("Paging",{attrs:{form:e.form,total:e.total},on:{paging:e.paging}}),t("Roleadd",{attrs:{dialogVisible:e.dialogVisible,modcom:e.modcom},on:{reseteditform:e.reseteditform,chansgedialogVisible:e.chansgedialogVisible}})],1)},l=[],s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.title,center:"center",visible:e.dialogVisible,width:"60%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.query,"label-width":"98px"}},[t("div",{staticClass:"tia"},[t("el-form-item",{staticStyle:{width:"130%"},attrs:{label:"账号：",prop:"name"}},[t("el-input",{model:{value:e.query.name,callback:function(t){e.$set(e.query,"name",t)},expression:"query.name"}})],1),t("el-form-item",{attrs:{label:"角色："}},e._l(e.list,(function(i,a){return t("div",{key:a,attrs:{checked:i.checked}},[t("el-checkbox",{attrs:{value:!!i.checked},on:{change:function(t){return e.handleCheckAllChange(t,i)}}},[e._v(e._s(i.name))]),t("el-checkbox-group",{on:{change:function(t){return e.handleCheckedCitiesChange(t,i)}},model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(i.children,(function(i,a){return t("el-checkbox",{key:a,attrs:{label:i.id,value:i.id}},[e._v(e._s(i.name))])})),1)],1)})),0)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.satlop}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("ruleForm")}}},[e._v("确 定")])],1)],1)},n=[],o=(i(7658),{name:"Roleadd",props:{dialogVisible:{type:Boolean,default:!1},modcom:{type:Object,default:()=>{}}},data(){var e=(e,t,i)=>{let a=/^[^\d][\u2E80-\u9FFFA-z-_.\d]{1,17}$/;if(!a.test(t))return i(new Error("账号是由汉字、字母2-18位组成的"));i()};return{title:"添加角色",query:{},rules:{name:[{required:!0,message:"请输入账号",trigger:"blur"},{validator:e,trigger:"blur"}]},list:[],checkedCities:[]}},created(){this.getitem()},updated(){this.title=this.modcom.id?"编辑角色":"添加角色",this.query=this.modcom?this.modcom:{}},methods:{async getitem(){let e=await this.http.get("/menu/list");1e4==e.errCode&&(this.list=e.data.list)},add(e){this.cities=e,this.checkedCities=e},handleCheckAllChange(e,t){e?(t.checked=1,t.children.forEach((e=>{this.checkedCities.push(e.id)}))):(t.checked=0,t.children.forEach((e=>{this.checkedCities.includes(e.id)&&(this.checkedCities=this.checkedCities.filter((t=>t!==e.id)))}))),console.log(t)},handleCheckedCitiesChange(e,t){let i=t.children.map((e=>e.id)),a=i.map((e=>this.checkedCities.includes(e))),l=a.filter((e=>1==e));i.length==l.length?(this.checkedCities.push(t.id),t.checked=1):(this.checkedCities=this.checkedCities.filter((e=>e!==t.id)),t.checked=0)},satlop(){this.$emit("chansgedialogVisible",!1)},submit(e){let t=[];this.checkedCities.forEach((e=>{t.push({id:e})})),this.query.menus=t,this.$refs[e].validate((async e=>{if(!e)return!1;{let e=await this.http.post("/administratorrole/add",this.query);1e4==e.errCode&&(this.$message.success("添加成功"),this.$emit("chansgedialogVisible",!1)),this.$emit("reseteditform")}}))},handleClose(e){this.$confirm("确认关闭？").then((()=>{this.$emit("chansgedialogVisible",!1)})).catch((()=>{}))}}}),r=o,c=i(1001),d=(0,c.Z)(r,s,n,!1,null,"16d8ed40",null),h=d.exports,u=i(466),m=i(2767),g={data(){return{loading:!0,form:{page:1,psize:5},query:{},tableData:[],tableCouml:[{prop:"id",label:"ID",width:"180"},{prop:"name",label:"姓名",width:"230"},{label:"操作",isshow:!0,showname:"option"}],total:0,dialogVisible:!1,modcom:{},power:[]}},components:{Roleadd:h,Table:u.Z,Paging:m.Z},created(){this.power=this.$power.getownpriv("角色管理管理"),this.getimet()},methods:{reseteditform(){this.modcom={}},dom(e){this.modcom=JSON.parse(JSON.stringify(e)),this.dialogVisible=!0},paging(){this.getimet()},handleDelete(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{let t=await this.http.get("/administratorrole/delete",{id:e});"10000"==t.errCode&&(this.$message.success("删除成功"),this.getimet())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},chansgedialogVisible(e){this.dialogVisible=e,this.getimet()},seratch(){this.getimet()},async getimet(){let e=await this.http.get("/administratorrole/list",this.form);"10000"==e.errCode&&(this.tableData=e.data.list,this.total=e.data.counts,this.loading=!1)},handleClose(e){this.$confirm("确认关闭？").then((()=>{e()})).catch((()=>{}))},handleSizeChange(e){this.form.psize=e,this.getimet(),this.loading=!1},handleCurrentChange(e){this.form.page=e,this.getimet(),this.loading=!1}}},p=g,f=(0,c.Z)(p,a,l,!1,null,"67ecfb3a",null),b=f.exports},2767:function(e,t,i){i.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"block"},[t("el-pagination",{attrs:{"current-page":this.query.page,"page-sizes":[5,10,15,20],"page-size":this.query.psize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},l=[],s={name:"Paging",props:{query:{type:Object,require:()=>{}},total:{type:Number,require:()=>{}}},data(){return{}},methods:{handleSizeChange(e){this.query.psize=e,this.loading=!1,this.$emit("paging")},handleCurrentChange(e){this.query.page=e,this.$emit("paging"),this.loading=!1}}},n=s,o=i(1001),r=(0,o.Z)(n,a,l,!1,null,"37f50908",null),c=r.exports},466:function(e,t,i){i.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"element-loading-background":"rgba(0, 0, 0, 0)"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),e._l(e.tableCouml,(function(i,a){return[i.isshow?t("el-table-column",{key:a,attrs:{label:i.label},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t(i.showname,null,{data:t.row})]}}],null,!0)}):t("el-table-column",{key:a,attrs:{prop:i.prop,label:i.label,width:i.width}})]}))],2)},l=[],s={name:"tablecom",props:{loading:{type:Boolean,default:()=>!0},tableData:{type:Array,default:()=>[]},tableCouml:{type:Array,default:()=>[]}},data(){return{}},created(){},methods:{handleSelectionChange(e){e.forEach((e=>{this.$emit("idshow",e.id)}))}}},n=s,o=i(1001),r=(0,o.Z)(n,a,l,!1,null,"8f316a3a",null),c=r.exports}}]);
//# sourceMappingURL=669.c9ab5525.js.map